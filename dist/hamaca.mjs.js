const t=t=>t instanceof g,s=s=>t(s)?s:new g(s),i=(t,s,i)=>{const e=new g(void 0,s);return n((()=>{e[o]=t(),h(e)}),i),e},e=[],h=t=>[...t[r]].forEach((t=>t())),n=(t,s)=>{const i=[],h=()=>{i.splice(0,i.length).forEach((t=>{t[r].splice(t[r].indexOf(n),1)}))},n=()=>{s?.()||(h(),e.unshift(i),t(),e.shift().forEach((t=>t[r].push(n))))};return n(),{cancel:h}},c=Symbol(),o=Symbol(),r=Symbol();let l=!1;const u=()=>l;function f(t){this[o]=t,h(this)}function a(t){const s=t(this[o]);return this.set(this[o]),s}class g{constructor(t,s){this[o]=t,this[r]=[],s&&(this.set=s,this.modify=a)}get(t=!0){return t&&e[0]&&!e[0].includes(this)&&e[0].push(this),this[o]}to(t,s){const e=this.set&&s?.from&&(t=>this.set(s.from(t)));return i((()=>t(this.get())),e)}child(s,e=!0){if(t(s)){const t=()=>this.child(s.get(e)).get(),h=this.set&&(t=>{this.child(s.get(!1)).set(t)});return i(t,h,u)}if(this[c]||(this[c]={}),!this[c][s]){const t=()=>this.get()?.[s],e=this.set&&(t=>{const i=l;l=!0,this.modify((i=>i[s]=t)),n[o]=t,l=i,h(n)}),n=i(t,e,u);this[c][s]=n}return this[c][s]}watch(t){return n((()=>t(this.get())))}}var d=Object.assign(((t,s=!0)=>new g(t,s&&f)),{ensure:s,calc:i,isData:t,sync:n,getAll:t=>t.map((t=>t.get())),ensureAll:t=>t.map((t=>s(t))),get:s=>t(s)?s.get():s});export default d;
