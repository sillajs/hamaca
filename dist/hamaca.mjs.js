const t=t=>new n(t).t(),s=s=>{const i=new h(void 0);return t((()=>i._set(s()))),i},i=t=>t instanceof h?t:new h(t),e=[];class n{constructor(t){this.fn=t,this.deps=[]}t(){this.deps.splice(0,this.deps.length).forEach((t=>{t.i.splice(t.i.indexOf(this),1)})),e.unshift(this.deps),this.fn(),e.shift().forEach((t=>t.i.push(this)))}}class h{constructor(t){this._data=t,this.i=[]}get(t=!0){return t&&e[0]&&!e[0].includes(this)&&e[0].push(this),this._data}map(t){return s((()=>t(this.get())))}mapIf(t,e){return t=i(t),s((()=>{const s=this.get();return t.get()?e(s):s}))}watch(s){return t((()=>{s(this.get())})),this}_set(t){this._data=t,this._modified()}_modified(){[...this.i].forEach((t=>t.t()))}}class r extends h{constructor(t){super(t)}set(t){this._set(t)}modify(t){t(this._data),this._modified()}}const c=(t,s=!1)=>!0===s?new h(t):new r(t);Object.assign(c,{ensure:i,calc:s,sync:t,getAll:t=>t.map((t=>t.get())),ensureAll:t=>t.map((t=>i(t))),isData:t=>t instanceof h});var o=c;export default o;
