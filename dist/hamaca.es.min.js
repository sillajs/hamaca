var $=function(){"use strict";const t=t=>t instanceof g,s=s=>t(s)?s:new g(s),i=(t,s,i)=>{const e=new g(void 0,s);return n((()=>{e[r]=t(),h(e)}),i),e},e=[],h=t=>[...t[o]].forEach((t=>t())),n=(t,s)=>{const i=[],h=()=>{i.splice(0,i.length).forEach((t=>{t[o].splice(t[o].indexOf(n),1)}))},n=()=>{s?.()||(h(),e.unshift(i),t(),e.shift().forEach((t=>t[o].push(n))))};return n(),{cancel:h}},c=Symbol(),r=Symbol(),o=Symbol();let u=!1;const l=()=>u;function f(t){this[r]=t,h(this)}function a(t){const s=t(this[r]);return this.set(this[r]),s}class g{constructor(t,s){this[r]=t,this[o]=[],s&&(this.set=s,this.modify=a)}get(t=!0){return t&&e[0]&&!e[0].includes(this)&&e[0].push(this),this[r]}to(t,s){const e=this.set&&s?.from&&(t=>this.set(s.from(t)));return i((()=>t(this.get())),e)}child(s,e=!0){if(t(s)){const t=()=>this.child(s.get(e)).get(),h=this.set&&(t=>{this.child(s.get(!1)).set(t)});return i(t,h,l)}if(this[c]||(this[c]={}),!this[c][s]){const t=()=>this.get()?.[s],e=this.set&&(t=>{const i=u;u=!0,this.modify((i=>i[s]=t)),n[r]=t,u=i,h(n)}),n=i(t,e,l);this[c][s]=n}return this[c][s]}watch(t){return n((()=>t(this.get())))}}return Object.assign(((t,s=!0)=>new g(t,s&&f)),{ensure:s,calc:i,isData:t,sync:n,getAll:t=>t.map((t=>t.get())),ensureAll:t=>t.map((t=>s(t))),get:s=>t(s)?s.get():s})}();
