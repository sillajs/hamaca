var $=function(){"use strict";const t=t=>t instanceof a,s=(s,e)=>t(s)?s:new a(s,e),e=(t,s,e)=>{const i=new a(void 0,s);return h((()=>{i[c]=t(),n(i)}),e),i},i=[],n=t=>[...t[r]].forEach((t=>t())),h=(t,s)=>{const e=[],n=()=>{e.splice(0,e.length).forEach((t=>{t[r].splice(t[r].indexOf(h),1)}))},h=()=>{s?.()||(n(),i.unshift(e),t(),i.shift().forEach((t=>t[r].push(h))))};return h(),{cancel:n}},c=Symbol(),r=Symbol(),o=Symbol();function u(t){this[o].willSet?.(t,this),this[c]=t,this[o].didSet?.(t,this),n(this)}function l(t){const s=t(this[c]);return this.set(this[c]),s}class a{constructor(t,s={}){this[c]=t,this[r]=[],this[o]=s,(s.mutable??1)&&(this.set=u,this.modify=l),s.setup?.(this)}toJSON(){return{value:this[c]}}get(t=!0){return t&&i[0]&&!i[0].includes(this)&&i[0].push(this),this[c]}to(t,s){const i=this[o].convertedDelegate?.(this),n=e((()=>t(this.get())),i,s);return this[o].didConvert?.(this,n),n}watch(t){return h((()=>t(this.get())))}}return Object.assign(((t,s)=>new a(t,s)),{ensure:s,calc:e,isData:t,sync:h,getAll:t=>t.map((t=>t.get())),ensureAll:t=>t.map((t=>s(t))),get:s=>t(s)?s.get():s})}();
